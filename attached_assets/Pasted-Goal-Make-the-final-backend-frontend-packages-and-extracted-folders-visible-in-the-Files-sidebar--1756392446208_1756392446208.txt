Goal: Make the final backend & frontend packages and extracted folders visible in the Files sidebar. If the tarballs don’t exist, recreate them. Then extract both under /home/runner/workspace/releases/ and print a clear summary with exact paths.
1) Locate existing tarballs
set -e
ROOT="/home/runner/workspace"
echo "=== SEARCHING FOR PACKAGES ==="
find "$ROOT" -maxdepth 4 -type f -name "peergos-backend-*.tar.gz" -printf "BACKEND:%p\n" || true
find "$ROOT" -maxdepth 4 -type f -name "peergos-frontend-*.tar.gz" -printf "FRONTEND:%p\n" || true
2) If missing, recreate tarballs (do not skip)
BACKEND_TARBALL=$(find "$ROOT" -maxdepth 4 -type f -name "peergos-backend-*.tar.gz" | sort | tail -n1)
FRONTEND_TARBALL=$(find "$ROOT" -maxdepth 4 -type f -name "peergos-frontend-*.tar.gz" | sort | tail -n1)

# Rebuild backend if not found
if [ -z "$BACKEND_TARBALL" ]; then
  echo "No backend tarball found. Rebuilding from peergos-backend-prod…"
  cd "$ROOT/peergos-backend-prod"
  npm ci
  npm run build
  TS=$(date +%Y%m%d-%H%M)
  tar -czf "peergos-backend-$TS-fixed.tar.gz" \
    --exclude="node_modules" --exclude=".git" --exclude="*.map" --exclude="*.log" \
    dist package.json package-lock.json tsconfig.json .env.example \
    MANIFEST.json PARITY_REPORT.md README.md
  BACKEND_TARBALL="$ROOT/peergos-backend-prod/peergos-backend-$TS-fixed.tar.gz"
fi

# Rebuild frontend if not found
if [ -z "$FRONTEND_TARBALL" ]; then
  echo "No frontend tarball found. Rebuilding from peergos-frontend-prod…"
  cd "$ROOT/peergos-frontend-prod"
  npm ci
  npm run build
  TS=$(date +%Y%m%d-%H%M)
  tar -czf "peergos-frontend-$TS.tar.gz" \
    --exclude="node_modules" --exclude=".git" --exclude="*.map" --exclude="*.log" \
    dist index.html package.json package-lock.json vite.config.ts tsconfig*.json \
    .env.example MANIFEST_FRONTEND.json FRONTEND_PARITY_REPORT.md README.md
  FRONTEND_TARBALL="$ROOT/peergos-frontend-prod/peergos-frontend-$TS.tar.gz"
fi
3) Create a visible releases area and copy tarballs
mkdir -p "$ROOT/releases"
cp "$BACKEND_TARBALL" "$ROOT/releases/" 2>/dev/null || true
cp "$FRONTEND_TARBALL" "$ROOT/releases/" 2>/dev/null || true
ls -lh "$ROOT/releases/"
4) Extract both tarballs into named folders (for browsing)
# Clean previous extractions to avoid confusion
rm -rf "$ROOT/releases/backend" "$ROOT/releases/frontend"
mkdir -p "$ROOT/releases/backend" "$ROOT/releases/frontend"

echo "=== EXTRACTING BACKEND ==="
tar -xzf "$BACKEND_TARBALL" -C "$ROOT/releases/backend"
echo "=== EXTRACTING FRONTEND ==="
tar -xzf "$FRONTEND_TARBALL" -C "$ROOT/releases/frontend"

echo "=== COUNTS ==="
echo "BACKEND_TARBALL: $(basename "$BACKEND_TARBALL")"
tar -tzf "$BACKEND_TARBALL" | wc -l | xargs echo "BACKEND_TARBALL_FILECOUNT"
echo "FRONTEND_TARBALL: $(basename "$FRONTEND_TARBALL")"
tar -tzf "$FRONTEND_TARBALL" | wc -l | xargs echo "FRONTEND_TARBALL_FILECOUNT"

echo "=== TOP-LEVEL OF EXTRACTED FOLDERS ==="
echo "Backend extracted to: $ROOT/releases/backend"
ls -la "$ROOT/releases/backend" | head -n 50
echo "Frontend extracted to: $ROOT/releases/frontend"
ls -la "$ROOT/releases/frontend" | head -n 50
5) (Optional) Bundle both into a single handover zip
cd "$ROOT/releases"
rm -f peergos-deployment-bundle.zip
zip -r peergos-deployment-bundle.zip backend frontend *.tar.gz >/dev/null
ls -lh peergos-deployment-bundle.zip
echo "BUNDLE_PATH=$ROOT/releases/peergos-deployment-bundle.zip"
6) Final output (print exact paths)
echo "==================== SUMMARY ===================="
echo "BACKEND_TARBALL_PATH=$BACKEND_TARBALL"
echo "FRONTEND_TARBALL_PATH=$FRONTEND_TARBALL"
echo "EXTRACTED_BACKEND_DIR=$ROOT/releases/backend"
echo "EXTRACTED_FRONTEND_DIR=$ROOT/releases/frontend"
echo "RELEASES_DIR=$ROOT/releases"
echo "================================================="
echo "Tip: If you don't see them in the sidebar, click the Files 'refres