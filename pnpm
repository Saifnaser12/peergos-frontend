#!/bin/bash
# pnpm compatibility wrapper for deployment environments
# This script routes pnpm commands to npm when pnpm is not available

# Check if actual pnpm exists
if command -v pnpm-real &> /dev/null || command -v pnpm.cmd &> /dev/null; then
    # Use real pnpm if available
    exec pnpm-real "$@" 2>/dev/null || exec pnpm.cmd "$@" 2>/dev/null
fi

# Fallback to npm for common pnpm commands
case "$1" in
    "run")
        echo "pnpm not found, using npm fallback..."
        if [ "$2" = "test:e2e" ]; then
            # Route test:e2e to package-scripts.js
            exec node package-scripts.js test:e2e
        else
            exec npm run "$2"
        fi
        ;;
    "install")
        echo "pnpm not found, using npm install..."
        exec npm install "${@:2}"
        ;;
    "build")
        echo "pnpm not found, using npm build..."
        exec npm run build
        ;;
    *)
        echo "pnpm command '$1' not supported in fallback mode"
        echo "Available fallback commands: run, install, build"
        exit 1
        ;;
esac